太好了，我们来写你这次「咖啡豆记录小程序」的 **V3 版本 PRD（产品需求文档）**，重点是新增筛选功能，应用在「豆单页」和「发现页」。

---

# ☕ CoffeeNote 小程序 V3 版本 PRD

**版本号**：V3
**功能主题**：新增「筛选功能」—— 手冲 / 意式 / 全部
**编写日期**：2025-11-12
**编写人**：楼晓雯

---

## 一、版本背景

在 V1/V2 版本中，用户已经可以：

* 在「豆单页」浏览和管理自己的咖啡豆记录；
* 在「发现页」查看他人公开的豆单或笔记。

但随着豆子记录越来越多，用户希望能**快速筛选出自己想看的豆子**（如手冲豆或意式豆），而不是在一个混合列表中反复滚动查找。

---

## 二、功能目标

✅ 让用户可以在「豆单页」和「发现页」中快速筛选显示：

* **全部豆子**
* **手冲豆**
* **意式豆**

✅ 支持记忆筛选状态（返回页面时保持上次选择）
✅ 确保筛选交互轻量化、不影响现有布局与操作逻辑

---

## 三、功能范围

| 模块  | 新增内容                                                                                      |
| --- | ----------------------------------------------------------------------------------------- |
| 豆单页 | 在顶部新增筛选控件，可筛选出全部 / 手冲 / 意式三类；数据展示逻辑根据筛选条件实时刷新                                             |
| 发现页 | 同步增加筛选控件，影响展示的豆子卡片列表                                                                      |
| 云函数 | `getBeanList`、`getDiscoverList` 需支持传入 `filterType` 参数（值为 `all` / `espresso` / `pourOver`） |

---

## 四、交互与UI设计

### 1️⃣ 筛选控件形式建议

**样式A：Segmented Control（分段选择）**

* 三个标签横向排列：“全部”、“手冲”、“意式”
* 选中态高亮（例如主题色背景、圆角矩形）
* 未选中态灰色边框文字

```text
[ 全部 ] [ 手冲 ] [ 意式 ]
```

**样式B（备用）：顶部弹出菜单**

* 点击右上角“筛选”图标，弹出选择菜单
* 适合后续扩展更多筛选条件（如烘焙度、国家、烘焙日期）

> 当前建议采用 **样式A（分段控件）**，更直观简洁。

---

### 2️⃣ 页面交互逻辑

#### 豆单页（MyBeans）

* 默认选中 “全部”
* 用户点击 “手冲” → 列表自动只显示冲煮方式为 `pourOver` 的豆子
* 用户点击 “意式” → 列表自动只显示冲煮方式为 `espresso` 的豆子
* 切换筛选条件后自动触发数据刷新
* 返回页面时，保持上一次筛选选项

#### 发现页（Discover）

* 顶部样式与豆单页一致
* 根据筛选条件，从云端拉取不同类别的公开豆单数据

---

### 3️⃣ 数据流示例

#### （1）前端调用

```js
// pages/beanList/index.js
wx.cloud.callFunction({
  name: 'getBeanList',
  data: {
    filterType: 'espresso' // all / espresso / pourOver
  },
  success: res => { this.setData({ beanList: res.result.data }) }
})
```

#### （2）云函数逻辑伪代码

```js
const db = cloud.database()
exports.main = async (event, context) => {
  const { filterType } = event
  const condition = {}

  if (filterType === 'espresso') {
    condition.brewType = '意式'
  } else if (filterType === 'pourOver') {
    condition.brewType = '手冲'
  }

  return await db.collection('beans')
    .where(condition)
    .get()
}
```

---

## 五、数据结构调整

### beans 表

新增字段（如果之前未定义）：

| 字段       | 类型     | 说明                           |
| -------- | ------ | ---------------------------- |
| brewType | String | 冲煮类型：`espresso` / `pourOver` |

---

## 六、状态保存方案

* 本地缓存：使用 `wx.setStorageSync('filterType', value)` 存储用户上次筛选状态
* 页面初始化时读取 `wx.getStorageSync('filterType')` 作为默认值

---

## 七、未来扩展方向

* 增加更多筛选维度（烘焙度、产地、烘焙日期）
* 支持多选筛选（如“手冲 + 中烘焙”）
* 搜索与筛选结合（搜索结果受筛选条件限制）

---

是否要我帮你接着出一个「V3.1 PRD」，扩展筛选为「烘焙度（浅、中、深）」和「国家（产地）」两级筛选？
那样会是这个功能的自然升级。
