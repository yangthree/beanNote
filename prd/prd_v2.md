
---

# ☕️ CoffeeNote 小程序 PRD v2

## 版本：V2 - 发布与发现功能

**阶段目标：**
实现用户在豆单详情页可以一键发布记录，并展示在公共「发现」页中，形成社区内容流。

---

## 🧭 一、整体结构变化

| 页面            | 新增 / 修改      | 说明                                     |
| ------------- | ------------ | -------------------------------------- |
| 我的豆单（Home）    | 无变化          | 仍为用户个人豆单记录页                            |
| 详情页（Detail）   | **新增“发布”按钮** | 用户可选择将此记录发布到发现页                        |
| 发现页（Discover） | **新增页面**     | 显示所有用户发布的豆单内容                          |
| 云数据库          | **新增 2 个集合** | `publish_records`, `users`             |
| 云函数           | **新增 2 个函数** | `publishRecord()`, `getDiscoverList()` |

---

## 🧩 二、功能设计

### 1. 详情页（Detail Page）

**目标：** 让用户在查看自己的一条豆单时，可以选择将其公开发布。

**交互逻辑：**

* 在右上角增加一个「☁️ 发布」按钮；
* 点击后弹出确认弹窗：

```
标题：是否发布这条豆单？
说明：发布后将展示在“发现”首页，其他用户可浏览。
按钮：取消 / 确认发布
```

**发布操作流程：**

1. 用户点击“确认发布”；
2. 调用云函数 `publishRecord()`；
3. 云函数将当前豆单内容写入 `publish_records` 集合；
4. 同时写入以下字段：

   ```js
   {
     beanId: "xxx",
     userId: "xxx",
     userName: "楼晓雯",
     userAvatar: "https://...",
     beanName: "Ethiopia Yirgacheffe",
     type: "Espresso",
     roastLevel: "中烘焙",
     origin: "埃塞俄比亚",
     flavorNotes: ["花香", "柑橘", "蜂蜜"],
     rating: 4.5,
     createTime: "2025-11-10T18:20:00Z",
     publishTime: "2025-11-11T09:00:00Z"
   }
   ```
5. 发布成功后提示：

   ```
   ✅ 发布成功
   你可以在“发现”页看到它
   ```

---

### 2. 发现页（Discover Page）

**目标：** 让所有用户可以看到他人发布的咖啡豆记录。

**页面结构：**

#### 顶部导航：

* 标题：**发现**
* 无搜索框（可后期扩展）

#### 列表布局（与“我的豆单”相似）：

每个卡片结构如下：

```
──────────────────────────────
👤 用户头像  用户昵称
🕓 发布于 2025-11-11 09:00
──────────────────────────────
豆子名：Ethiopia Yirgacheffe
品牌：Manner
烘焙度：中烘焙
产地：埃塞俄比亚
类型：意式
⭐️ 评分：4.5
──────────────────────────────
```

#### 动作：

* 点击卡片 → 打开详情页（只读模式）；
* 下拉刷新；
* 无限滚动加载更多。

#### 空状态：

> “还没有人发布豆单，来成为第一个吧 ☕️”

---

### 3. 云开发部分

#### 数据库结构：

##### `beans`（原有）

用户的私有记录。

##### `publish_records`

公开的发布内容。

| 字段          | 类型     | 说明                   |
| ----------- | ------ | -------------------- |
| beanId      | String | 来源于 beans 表          |
| userId      | String | 发布者用户 ID             |
| userName    | String | 发布者昵称                |
| userAvatar  | String | 发布者头像                |
| beanName    | String | 豆子名                  |
| type        | String | Espresso / Pour-over |
| roastLevel  | String | 烘焙度                  |
| origin      | String | 产地                   |
| flavorNotes | Array  | 风味描述                 |
| rating      | Number | 用户评分                 |
| publishTime | Date   | 发布时间                 |

##### `users`

存储用户信息（昵称、头像、注册时间等）。

---

#### 云函数设计：

##### ① `publishRecord()`

**入参：**

```js
{
  beanId: "xxx",
  userId: "xxx"
}
```

**逻辑：**

1. 查询 beans 表；
2. 取出对应数据；
3. 写入 publish_records；
4. 返回 success / fail。

##### ② `getDiscoverList()`

**入参：**

```js
{
  page: 1,
  pageSize: 10
}
```

**逻辑：**

* 从 `publish_records` 中按 `publishTime` 倒序获取；
* 可后续加缓存、分页加载。

---

### 4. 用户授权与头像昵称

* 首次发布时，需调用 `wx.getUserProfile()`；
* 写入/更新到 `users` 集合；
* 头像与昵称用于发现页显示；
* 若用户未授权，点击“发布”时弹出授权提示。

---

## 🎨 三、视觉规范补充

* 发现页整体延续「我的豆单」风格；
* 背景色：`#F5F3EE`；
* 用户信息部分用浅灰分隔；
* 时间信息字体为 `12px`；
* 用户头像使用圆形裁剪。

---

## 🧠 四、扩展预留

| 模块      | 说明              |
| ------- | --------------- |
| 点赞 / 收藏 | 后续可在卡片底部加入互动按钮  |
| 评论      | 详情页下方展示评论区      |
| 举报      | 长按内容触发举报弹窗      |
| 用户主页    | 点击头像可查看该用户的公开豆单 |

---
