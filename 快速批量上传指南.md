# ğŸš€ å¿«é€Ÿæ‰¹é‡ä¸Šä¼  JSON æ•°æ®åˆ°å‘ç°é¡µ

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨äº‘å¼€å‘æ§åˆ¶å°ï¼ˆæœ€ç®€å•ï¼‰â­

### æ­¥éª¤ï¼š

1. **ä¸Šä¼ äº‘å‡½æ•°**
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œå³é”® `cloudfunctions/batchPublishRecords`
   - é€‰æ‹© **"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"**
   - é€‰æ‹©å¯¹åº”çš„ç¯å¢ƒ

2. **å‡†å¤‡æ•°æ®**
   - æ‰“å¼€ `prd/beans_full.json` æ–‡ä»¶
   - å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼ˆCtrl+A, Ctrl+Cï¼‰

3. **åœ¨äº‘å¼€å‘æ§åˆ¶å°æ‰§è¡Œ**
   - æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
   - è¿›å…¥ **"äº‘å¼€å‘"** â†’ **"äº‘å‡½æ•°"**
   - æ‰¾åˆ° `batchPublishRecords` å‡½æ•°
   - ç‚¹å‡» **"æµ‹è¯•"** æŒ‰é’®
   - **é‡è¦ï¼šé€‰æ‹© "äº‘ç«¯è°ƒè¯•"**ï¼ˆä¸è¦é€‰æ‹©"æœ¬åœ°è°ƒè¯•"ï¼Œå› ä¸ºéœ€è¦è®¿é—®äº‘æ•°æ®åº“ï¼‰
   - åœ¨æµ‹è¯•å‚æ•°ä¸­è¾“å…¥ï¼š

```json
{
  "records": [ç²˜è´´ JSON æ•°ç»„å†…å®¹],
  "batchSize": 10,
  "startIndex": 0
}
```

   **é‡è¦å‚æ•°è¯´æ˜ï¼š**
   - `batchSize`: æ¯æ‰¹å¤„ç†æ•°é‡ï¼Œå»ºè®®è®¾ç½®ä¸º **10-20**ï¼ˆé¿å…è¶…æ—¶ï¼‰
   - `startIndex`: èµ·å§‹ç´¢å¼•ï¼Œç¬¬ä¸€æ¬¡ä» 0 å¼€å§‹ï¼Œåç»­æ ¹æ®è¿”å›çš„ `nextIndex` ç»§ç»­

4. **æ‰§è¡Œå¹¶æŸ¥çœ‹ç»“æœ**
   - ç‚¹å‡» **"æµ‹è¯•"** æ‰§è¡Œ
   - æŸ¥çœ‹è¿”å›ç»“æœï¼š
     - `successCount`: æˆåŠŸæ•°é‡
     - `failCount`: å¤±è´¥æ•°é‡
     - `hasMore`: æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
     - `nextIndex`: ä¸‹æ¬¡å¼€å§‹çš„ç´¢å¼•ï¼ˆå¦‚æœæœ‰ï¼‰

5. **åˆ†æ‰¹ç»§ç»­ä¸Šä¼ **ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
   - å¦‚æœè¿”å› `hasMore: true`ï¼Œç»§ç»­æ‰§è¡Œ
   - ä¿®æ”¹å‚æ•°ä¸­çš„ `startIndex` ä¸ºè¿”å›çš„ `nextIndex` å€¼
   - å†æ¬¡ç‚¹å‡» **"æµ‹è¯•"** æ‰§è¡Œ
   - é‡å¤ç›´åˆ° `hasMore: false`

## æ–¹æ³•äºŒï¼šä½¿ç”¨å°ç¨‹åºæµ‹è¯•é¡µé¢

### æ­¥éª¤ï¼š

1. **æ·»åŠ æµ‹è¯•é¡µé¢åˆ° app.json**
   ```json
   {
     "pages": [
       "pages/index/index",
       "pages/discover/discover",
       "pages/detail/detail",
       "pages/beanDetail/beanDetail",
       "pages/test/batchUpload"
     ]
   }
   ```

2. **ä¿®æ”¹ batchUpload.js**
   - ç”±äºå°ç¨‹åºæ— æ³•ç›´æ¥è¯»å–æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨å°† JSON æ•°æ®å¤åˆ¶åˆ°ä»£ç ä¸­
   - æˆ–è€…ä½¿ç”¨ç½‘ç»œè¯·æ±‚è·å– JSON æ•°æ®

3. **è®¿é—®æµ‹è¯•é¡µé¢**
   - åœ¨å°ç¨‹åºä¸­è·³è½¬åˆ° `pages/test/batchUpload`
   - ç‚¹å‡»ä¸Šä¼ æŒ‰é’®

## æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Node.js è„šæœ¬ï¼ˆæ¨èç”¨äºå¤§é‡æ•°æ®ï¼‰

åˆ›å»ºä¸€ä¸ª Node.js è„šæœ¬æ¥æ‰¹é‡ä¸Šä¼ ï¼š

```javascript
// scripts/batchUpload.js
const cloud = require('wx-server-sdk')
const fs = require('fs')
const path = require('path')

// åˆå§‹åŒ–ï¼ˆéœ€è¦é…ç½®ç¯å¢ƒIDï¼‰
cloud.init({
  env: 'your-env-id' // æ›¿æ¢ä¸ºå®é™…ç¯å¢ƒID
})

async function main() {
  try {
    // è¯»å– JSON æ–‡ä»¶
    const jsonPath = path.join(__dirname, '../prd/beans_full.json')
    const jsonData = JSON.parse(fs.readFileSync(jsonPath, 'utf8'))
    
    console.log(`å‡†å¤‡ä¸Šä¼  ${jsonData.length} æ¡è®°å½•`)
    
    // è°ƒç”¨äº‘å‡½æ•°
    const result = await cloud.callFunction({
      name: 'batchPublishRecords',
      data: {
        records: jsonData,
        batchSize: 50
      }
    })
    
    console.log('ä¸Šä¼ ç»“æœ:', result.result)
  } catch (error) {
    console.error('é”™è¯¯:', error)
  }
}

main()
```

è¿è¡Œï¼š
```bash
node scripts/batchUpload.js
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®é‡**ï¼šJSON æ–‡ä»¶æœ‰ 9551 è¡Œï¼ŒåŒ…å«å¤§é‡è®°å½•ï¼Œå»ºè®®åˆ†æ‰¹ä¸Šä¼ 
2. **è¶…æ—¶é™åˆ¶**ï¼šäº‘å‡½æ•°æœ‰æ‰§è¡Œæ—¶é—´é™åˆ¶ï¼Œå¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡æ‰§è¡Œ
3. **é‡å¤æ£€æŸ¥**ï¼šäº‘å‡½æ•°ä¼šè‡ªåŠ¨æ£€æŸ¥é‡å¤è®°å½•ï¼ˆæ ¹æ® beanId å’Œ userIdï¼‰ï¼Œå·²å­˜åœ¨çš„è®°å½•ä¼šè¢«è·³è¿‡
4. **è¯„åˆ†æ ¼å¼**ï¼šæ”¯æŒ "4-", "4+", "4.5" ç­‰å­—ç¬¦ä¸²æ ¼å¼ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­—
5. **æ—¶é—´æ ¼å¼**ï¼šæ”¯æŒ ISO å­—ç¬¦ä¸²å’Œ MongoDB æ—¥æœŸæ ¼å¼

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

JSON ä¸­çš„æ¯æ¡è®°å½•ä¼šè¢«è½¬æ¢ä¸ºä»¥ä¸‹æ ¼å¼ï¼š

```javascript
{
  beanId: "excel_1",
  userId: "batch_import", // æ‰¹é‡å¯¼å…¥ä½¿ç”¨å›ºå®šID
  userName: "ç¬¬8ä¸ªçŸ®äºº(å°çº¢ä¹¦)",
  userAvatar: "",
  beanName: "é‡è‰è“",
  brand: "æ²»å…‰å¸ˆ",
  type: "Pour Over", // å¦‚æœä¸ºç©ºï¼Œé»˜è®¤ä¸ºæ‰‹å†²
  roastLevel: "",
  origin: "åŸƒå¡",
  altitude: "",
  processMethod: "",
  roastDate: "",
  flavorNotes: ["è‰è“é…±", "ç”œæ©™"],
  rating: 4.0, // è‡ªåŠ¨è½¬æ¢è¯„åˆ†æ ¼å¼
  createTime: Date,
  publishTime: Date
}
```

## ğŸ” æŸ¥çœ‹ä¸Šä¼ ç»“æœ

ä¸Šä¼ å®Œæˆåï¼Œå¯ä»¥åœ¨ï¼š
- **äº‘å¼€å‘æ§åˆ¶å°** â†’ **æ•°æ®åº“** â†’ **publish_records** é›†åˆä¸­æŸ¥çœ‹
- **å‘ç°é¡µ**ä¸­æŸ¥çœ‹ä¸Šä¼ çš„è®°å½•

