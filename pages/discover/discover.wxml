<!-- pages/discover/discover.wxml -->
<!-- 发现页：展示所有用户发布的咖啡豆记录 -->
<view class="page">

  <!-- 筛选控件（Segmented Control） -->
  <view class="filter-container">
    <view 
      class="filter-item {{filterType === 'all' ? 'active' : ''}}"
      data-type="all"
      bindtap="onFilterTypeChange"
    >
      全部
    </view>
    <view 
      class="filter-item {{filterType === 'pourOver' ? 'active' : ''}}"
      data-type="pourOver"
      bindtap="onFilterTypeChange"
    >
      手冲
    </view>
    <view 
      class="filter-item {{filterType === 'espresso' ? 'active' : ''}}"
      data-type="espresso"
      bindtap="onFilterTypeChange"
    >
      意式
    </view>
  </view>

  <!-- 评分筛选 -->
  <view class="rating-filter-container">
    <scroll-view class="rating-filter-scroll" scroll-x="{{true}}" show-scrollbar="{{false}}">
      <view class="rating-filter-options">
        <view
          class="rating-filter-item {{ratingFilter === option.key ? 'active' : ''}}"
          wx:for="{{ratingOptions}}"
          wx:for-item="option"
          wx:key="key"
          data-key="{{option.key}}"
          bindtap="onRatingFilterChange"
        >
          {{option.label}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 空状态提示 -->
  <view class="empty-state" wx:if="{{discoverList.length === 0 && !loading}}">
    <text class="empty-text">还没有人发布豆单，来成为第一个吧 ☕️</text>
  </view>

  <!-- 发现列表 -->
  <scroll-view 
    class="discover-list" 
    scroll-y="{{true}}"
    refresher-enabled="{{true}}"
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
    enhanced="{{true}}"
    bounces="{{false}}"
    show-scrollbar="{{false}}"
    wx:else
  >
    <view class="bean-list">
      <view class="bean-card" wx:for="{{discoverList}}" wx:key="beanId" wx:for-item="item" wx:for-index="index" bindtap="viewDetail" data-bean="{{item}}" data-record-id="{{item._id}}">
        <!-- 图片封面：显示豆袋图片或占位 -->
        <view class="bean-image-wrapper">
          <view class="bean-image-placeholder">☕</view>
          <view class="bean-badge">{{item.type === 'pourOver' ? '手冲' : '意式'}}/{{item.roastLevel}}</view>
        </view>

        <!-- 内容区 -->
        <view class="bean-content">
          <!-- 第一行：豆名 + 品牌 -->
          <view class="bean-title-row">
            <text class="bean-name">{{item.beanName || '未命名咖啡豆'}}</text>
            <text class="bean-brand" wx:if="{{item.brand}}">{{item.brand}}</text>
          </view>

          <!-- 第二行：产地 + 评分 -->
          <view class="bean-info-row">
            <text class="bean-origin" wx:if="{{item.origin}}">{{item.origin}}</text>
            <view class="bean-rating">
              <text class="star active">★</text>
              <text class="rating-value">{{item.displayRating}}</text>
            </view>
          </view>

          <!-- 第三行：处理法 + 右侧预留 -->
          <view class="bean-info-row">
            <text class="bean-process" wx:if="{{item.processMethod}}">{{item.processMethod}}</text>
            <view class="bean-extra-placeholder"></view>
          </view>
        </view>

        <!-- 用户信息区域（底部） -->
        <view class="user-info-header">
          <image class="user-avatar" src="{{item.userAvatar}}" mode="aspectFill" lazy-load="{{true}}"></image>
          <view class="user-info-text">
            <text class="user-name">{{item.userName}}</text>
            <text class="publish-time">{{item.publishTime}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 加载更多提示 -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <text>加载更多...</text>
    </view>
    <view class="load-more" wx:if="{{!hasMore && discoverList.length > 0}}">
      <text>没有更多了</text>
    </view>
  </scroll-view>

  <!-- 加载中提示 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>
</view>

