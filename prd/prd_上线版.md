# ☕ CoffeeNote 咖啡豆记录小程序 - 整合PRD

## 版本历史
- **v1.0** - 基础功能：豆单管理、新建/编辑记录
- **v2.0** - 社交功能：发布到发现页、社区浏览
- **v3.0** - 筛选功能：类型筛选、状态记忆
- **v4.0** - 详情页面：完整展示、只读模式

---

## 1. 产品概述

### 1.1 产品目标
帮助咖啡爱好者随手记录与管理日常咖啡豆信息、冲煮参数与主观评分，形成可检索的个人「豆单」，并通过社区分享功能促进用户交流与发现。

### 1.2 用户画像
- 咖啡爱好者、家庭玩家、入门店家
- 日常尝试不同豆子并希望复盘冲煮经验
- 喜欢分享咖啡体验并探索他人推荐

### 1.3 核心价值
- **极简记录**：降低记录门槛，提高复盘效率
- **个人知识库**：构建可搜索的个人咖啡数据库
- **社区互动**：分享发现，获取灵感

---

## 2. 信息架构

```
Tab栏结构：
├── 我的豆单（首页）
├── 发现（社区内容）
└── 我的（预留）

页面层级：
我的豆单 → 详情页 → 编辑页
发现页 → 详情页（只读）
```

---

## 3. 功能模块详解

### 3.1 我的豆单（首页）

**功能特性：**
- 两列卡片式布局展示个人豆单
- 搜索功能（名称/品牌/产地/风味）
- 筛选功能（全部/手冲/意式）
- 长按删除记录
- 悬浮+按钮新建记录

**交互细节：**
- 点击卡片进入详情页
- 长按弹出删除菜单（二次确认）
- 筛选状态本地缓存记忆
- 空状态引导新建记录

### 3.2 新建/编辑记录

**字段结构：**

**基本信息：**
- 咖啡豆名称（必填，1-40字）
- 品牌（选填，0-30字）
- 评分（1.0-5.0，步进0.5）
- 烘焙度（浅烘/中浅烘/中烘/中深烘/深烘）
- 产地（选填，0-30字）

**冲煮参数（类型相关）：**
- **手冲豆**：粉量、水量、水温、时间、研磨度
- **意式豆**：粉量、出品量、时间、研磨度

**扩展信息：**
- 风味标签（自由输入+常用选择）
- 设备信息（滤杯/壶具、磨豆机）
- 备注（0-300字）

### 3.3 详情页面

**页面结构：**
1. 顶部导航：返回 + 分享
2. 封面图（4:3比例，无图默认）
3. 标题区：名称 + 产区
4. 标签模块：风味标签（最多4个，超出折叠）
5. 基础信息卡片：烘焙度、处理法、海拔、烘焙日期
6. 冲煮参数卡片：粉水比、研磨度、水温、时间
7. 用户笔记模块
8. 操作按钮：编辑、发布（我的豆单）/ 只读（发现页）

**交互模式：**
- **我的豆单进入**：可编辑，有发布按钮
- **发现页进入**：只读模式

### 3.4 发现页面

**功能特性：**
- 浏览所有用户发布的豆单
- 筛选功能（全部/手冲/意式）
- 下拉刷新 + 无限滚动
- 用户信息展示（头像、昵称、发布时间）

**内容卡片结构：**
```
用户头像 + 昵称 + 发布时间
────────────────
豆子名称 + 品牌
烘焙度 + 产地 + 类型
评分（星级+数值）
```

### 3.5 发布功能

**发布流程：**
1. 在详情页点击「发布」按钮
2. 确认弹窗提示发布效果
3. 调用云函数写入发布记录
4. 成功提示并刷新状态

**用户授权：**
- 首次发布需要微信用户信息授权
- 用户信息存储至users集合

---

## 4. 筛选系统（v3）

### 4.1 筛选控件
- **形式**：分段选择器（全部/手冲/意式）
- **位置**：豆单页和发现页顶部
- **交互**：点击即筛选，状态自动保存

### 4.2 技术实现
```javascript
// 前端调用
wx.cloud.callFunction({
  name: 'getBeanList',
  data: { filterType: 'espresso' } // all/espresso/pourOver
})

// 状态保存
wx.setStorageSync('filterType', value)
```

---

## 5. 数据结构

### 5.1 核心数据模型

```javascript
// 咖啡豆基础信息
{
  id: string,
  type: 'pourOver' | 'espresso',
  name: string,
  brand?: string,
  roastLevel?: string,
  origin?: string,
  flavors?: string[],
  notes?: string,
  rating?: number,        // 0-5, step 0.5
  coverImage?: string,
  createdAt: ISOString,
  updatedAt: ISOString,
  
  // 冲煮参数
  brewParams?: {
    coffeeWeight?: number,    // g
    waterWeight?: number,     // ml
    temperature?: number,     // °C
    time?: number,            // s
    grindSize?: string
  },
  
  // 扩展信息（v4）
  processMethod?: string,
  altitude?: number,
  roastDate?: string
}
```

### 5.2 发布记录模型
```javascript
{
  beanId: string,
  userId: string,
  userName: string,
  userAvatar: string,
  beanName: string,
  type: string,
  roastLevel: string,
  origin: string,
  flavorNotes: string[],
  rating: number,
  publishTime: Date
}
```

---

## 6. 云开发架构

### 6.1 数据库集合
- `beans` - 用户私有豆单记录
- `publish_records` - 公开发布内容
- `users` - 用户基本信息

### 6.2 云函数
- `publishRecord()` - 发布豆单到发现页
- `getDiscoverList()` - 获取发现页内容
- `getBeanList()` - 获取豆单列表（支持筛选）

---

## 7. 交互规范

### 7.1 校验规则
- **必填**：咖啡豆名称
- **长度限制**：名称≤40，品牌/产地≤30，备注≤300
- **数字范围**：
  - 评分：1.0-5.0（0.5步进）
  - 粉量：0-200g，水量：0-1000ml
  - 水温：70-100°C，时间：0-600s

### 7.2 反馈机制
- 保存成功：Toast提示并返回
- 删除操作：二次确认弹窗
- 发布成功：明确成功提示
- 加载失败：重试按钮+错误提示

---

## 8. 视觉设计

### 8.1 色彩系统
- **主背景**：`#F9F7F5`（浅米白）
- **卡片背景**：`#FFFFFF`
- **强调色**：`#D6B58F`（浅咖啡色）
- **文字色**：主文字`#333333`，次级`#888888`

### 8.2 设计规范
- **圆角**：卡片20rpx，按钮16rpx
- **字体**：28-36rpx，确保可读性
- **触控区**：≥88rpx
- **动效**：按压缩放0.98，颜色加深10%

### 8.3 组件规范
- **卡片**：白色背景，浅阴影，统一圆角
- **标签**：浅色背景+咖啡色描边
- **分段选择器**：主题色高亮选中状态
- **空状态**：居中引导文案+操作按钮

---

## 9. 性能与兼容性

### 9.1 性能标准
- 本地存储使用`wx.setStorageSync`
- 列表渲染≤200条无卡顿
- 页面切换≤300ms
- 适配iPhone小屏设备

### 9.2 异常处理
- 无网络：明确提示+重试机制
- 图片加载失败：默认占位图
- 记录不存在：友好提示+返回引导
- 权限失败：Toast通知+操作建议

---

## 10. 未来迭代规划

### 10.1 近期规划（v1.1）
- 图片上传功能
- 品牌/烘焙度字典管理
- 风味标签推荐系统

### 10.2 中期规划（v2.0）
- 云端同步与账号体系
- 数据统计与报表
- 冲煮曲线记录
- 点赞/收藏互动功能

### 10.3 长期愿景
- 用户主页与关注系统
- 高级筛选（烘焙度、产地、日期）
- 咖啡店地理位置整合
- 冲煮方案智能推荐

---

## 11. 技术备注

### 11.1 兼容性说明
- 基于微信小程序云开发
- 使用微信原生组件库
- 支持iOS/Android微信客户端

### 11.2 数据安全
- 用户私有数据隔离存储
- 发布内容需用户明确授权
- 敏感操作需二次确认

---

*本文档整合了v1-v4所有功能需求，如需查看特定版本详细变更，请参考对应版本的独立PRD文档。*